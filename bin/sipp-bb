#!/bin/bash
# make qstream statistics from sipp-test logs
# - listen to updates on the task.log file

if test .$1 = .-cf ; then
  source  $2
  shift; shift
else
  source /etc/sipshaman/sipshaman.cf
fi

    while test 1=1 ; do
	ps -ef | egrep -q "$BIN/qstream-[s]ipp-check .*-bb $BB_HOST" -

	if test $? = 1; then # not found

	    hdir=`date +$DATA/%Y/%m/%d/%H`
	    cd $hdir

	    if test -s task.log; then # do not start until any data
		lifemin="$((60-`date +%M|sed -e s/^0//`))"
		$BIN/qstream-sipp-check $* -v -xml -bb $BB_HOST -f -die $lifemin task.log
		sleep 3
	    fi
	fi
	sleep 3
    done


